# Phone Defect Detection Training Configuration
# 모델 학습에 필요한 설정입니다.

# 프로젝트 기본 설정
project:
  name: "phone_defect_detection"
  version: "2.0.0"
  seed: 42

# 입력 이미지 설정
input:
  width: 1920
  height: 1080

# 데이터 경로 설정
data:
  # 학습/검증/테스트 데이터 경로
  train_path: "data/train"
  val_path: "data/val"
  test_path: "data/test"
  
  # 데이터 형식
  phone_detection_format: "yolo"  # yolo 또는 coco
  defect_segmentation_format: "mask"  # mask (각 pixel이 등급을 나타냄)
  
  # 클래스 정보
  phone_classes:
    num_classes: 1
    class_names:
      - "phone"
  
  # 결함 등급
  defect_grades:
    - "A"  # 정상
    - "B"  # 경미한 결함
    - "C"  # 중간 결함
    - "D"  # 심한 결함
    num_classes: 4  # A, B, C, D

# Phone Region Detection 설정
phone_detection:
  # 전면/후면: YOLO 사용
  front:
    method: "yolo"  # yolo 또는 segmentation
    model: "yolo11n.pt"
    trained_model: "weights/phone_detection/front_best.pt"
    input_size:
      width: 640
      height: 640
  
  back:
    method: "yolo"
    model: "yolo11n.pt"
    trained_model: "weights/phone_detection/back_best.pt"
    input_size:
      width: 640
      height: 640
  
  # 측면/디스플레이: Segmentation 사용
  side:
    method: "segmentation"
    model:
      encoder_name: "efficientnet-b3"
      encoder_weights: "imagenet"
      classes: 5  # 배경 + 4개 영역
    trained_model: "weights/phone_detection/side_best.pt"
    input_size:
      width: 1920
      height: 1080
  
  display:
    method: "segmentation"
    model:
      encoder_name: "efficientnet-b3"
      encoder_weights: "imagenet"
      classes: 2  # 배경 + 디스플레이
    trained_model: "weights/phone_detection/display_best.pt"
    input_size:
      width: 512
      height: 512

# Defect Segmentation 모델 설정
defect_segmentation:
  # 디스플레이 (Display)
  display:
    model:
      encoder_name: "efficientnet-b4"
      encoder_weights: "imagenet"
      decoder_name: "unet"
      classes: 4  # A, B, C, D
    trained_model: "weights/defect_segmentation/display_best.pt"
    input_size:
      width: 928
      height: 512
  
  # 측면 (Side/Corner)
  side:
    model:
      encoder_name: "efficientnet-b4"
      encoder_weights: "imagenet"
      decoder_name: "unet"
      classes: 3  # A, B, C (측면은 A, B, C만)
    trained_model: "weights/defect_segmentation/side_best.pt"
    input_size:
      width: 768
      height: 256
  
  # 전면 (Front/Top)
  front:
    model:
      encoder_name: "efficientnet-b4"
      encoder_weights: "imagenet"
      decoder_name: "unet"
      classes: 4
    trained_model: "weights/defect_segmentation/front_best.pt"
    input_size:
      width: 480
      height: 256

# 학습 설정
training:
  # 기본 하이퍼파라미터
  batch_size: 16
  num_epochs: 100
  num_workers: 4
  pin_memory: true
  
  # Optimizer 설정
  optimizer:
    name: "adamw"  # adam, adamw, sgd
    lr: 0.001
    weight_decay: 0.0001
    momentum: 0.9  # SGD 사용 시만
  
  # Learning Rate Scheduler
  scheduler:
    name: "cosine"  # cosine, step, plateau
    T_max: 100
    eta_min: 0.00001
    step_size: 30
    gamma: 0.1
    factor: 0.5
    patience: 5
  
  # Loss 설정 (Segmentation)
  loss:
    type: "dice"  # dice, cross_entropy, focal
    focal_alpha: 0.25
    focal_gamma: 2.0
    class_weights: [1.0, 2.0, 3.0, 4.0]  # A, B, C, D 가중치
  
  # Validation 설정
  val_interval: 1
  save_interval: 10
  
  # Early Stopping
  early_stopping:
    enabled: true
    patience: 15
    min_delta: 0.001

# 전처리 설정
preprocessing:
  # Resize 설정
  resize:
    keep_aspect_ratio: false
  
  # Normalization
  normalization:
    type: "imagenet"  # imagenet, custom, none
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]
  
  # CLAHE (Contrast Limited Adaptive Histogram Equalization)
  clahe:
    clip_limit: 2.0
    tile_grid_size: [8, 8]
  
  # Augmentation (학습 시에만 적용)
  augmentation:
    horizontal_flip:
      enabled: true
      probability: 0.5
    rotation:
      enabled: true
      probability: 0.5
      max_angle: 15
    color_jitter:
      enabled: true
      probability: 0.5
      brightness: 0.2
      contrast: 0.2
      saturation: 0.2
      hue: 0.1

# 경로 설정
paths:
  weights_dir: "weights"
  checkpoint_dir: "weights/checkpoints"
  output_dir: "results"
  log_dir: "logs"
  tensorboard_dir: "runs"

# 하드웨어 설정
device:
  type: "cuda"  # cuda, cpu, mps
  device_id: 0

# 로깅 설정
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_file: "logs/training.log"
  console_output: true

# 평가 설정
evaluation:
  metrics:
    - "iou"  # Intersection over Union
    - "pixel_accuracy"
    - "grade_accuracy"  # 등급별 정확도
    - "confusion_matrix"
  
  # IoU threshold for evaluation
  iou_thresholds: [0.5, 0.75]

